<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>标签云</title>
		<style>
			h1{
				text-align: center;
				margin: 50px auto;
			}
			#tag-cloud{
				width: 500px;
				height: 500px;
				margin:0 auto;
			}
		</style>
	</head>
	<body>
		<h1>3D 标签云</h1>
		<div id="tag-cloud">
			<a class="tag" href="#">标签1</a>
			<a class="tag" href="#">标签2</a>
			<a class="tag" href="#">标签3</a>
			<a class="tag" href="#">标签4</a>
			<a class="tag" href="#">标签5</a>
			<a class="tag" href="#">标签6</a>
			<a class="tag" href="#">标签7</a>
			<a class="tag" href="#">标签8</a>
			<a class="tag" href="#">标签9</a>
			<a class="tag" href="#">标签10</a>
			<a class="tag" href="#">标签11</a>
			<a class="tag" href="#">标签12</a>
			<a class="tag" href="#">标签13</a>
			<a class="tag" href="#">标签14</a>
			<a class="tag" href="#">标签15</a>
			<a class="tag" href="#">标签16</a>
			<a class="tag" href="#">标签17</a>
			<a class="tag" href="#">标签18</a>
			<a class="tag" href="#">标签19</a>
			<a class="tag" href="#">标签20</a>
		</div>
		<script>
			(function(){
				var api={
					config:function(opts){
						//默认参数
						var options={
							radius:200,
							maxFont:30,
							color:true, //设置标签颜色，设置为true为随机颜色，也可以设置其他色值
							rotateAngleXbase:300,//默认旋转速度基数，数越小速度越快
							rotateAngleYbase:300,
							hover:true,//是否开启悬浮联动
						}
						//合并传入的参数和默认参数，最终参数为setting
						var setting={};
						for(prop in options){
							setting[prop]=options[prop];
						}
						for (prop in opts){
							setting[prop]=opts[prop]
						};
						//获取标签元素及父元素
						var tagCloud=document.getElementById('tag-cloud');
						var tags=tagCloud.getElementsByClassName("tag");
						//让标签元素相对标签云元素绝对定位
						tagCloud.style.position="relative";
						for(var i=0;i<tags.length;i++){
							tags[i].style.position="absolute";
							tags[i].style.left="0";
							tags[i].style.top="0";
						}
						var allTag=[];//标签数组
						var rotateAngleX=Math.PI/setting.rotateAngleXbase;
						var rotateAngleY=Math.PI/setting.rotateAngleYbase;
						function init(r){
							for(var i=0,length=tags.length;i<length;i++){
								if(setting.color === true){
									tags[i].style.color="rgb("+Math.round(255*Math.random())+","+Math.round(255*Math.random())+","+Math.round(255*Math.random())+")";
								}else{
									tags[i].style.color=setting.color;
								}

								// 获取球面上均匀的点的经纬度 θ = arccos( ((2*num)-1)/all - 1); Φ = θ*sqrt(all * π);
								var angleX=Math.acos((2*(i+1)-1)/length-1);
								var angleY=angleX*Math.sqrt(length*Math.PI);
								//根据经纬度获取点的坐标，球中心的点坐标是 (0,0,0) x=r*sinθ*cosΦ   y=r*sinθ*sinΦ   z=r*cosθ;
								var x=r*Math.sin(angleX)*Math.cos(angleY);
								var y=r*Math.sin(angleX)*Math.sin(angleY);
								var z=r*Math.cos(angleX);
								//每个标签对象都有四对值
								var tag={
									x:x,y:y,z:z,ele:tags[i]
								};
								allTag.push(tag);
							}
						}
						//设置每个标签的坐标位置和字体大小以及透明度
						function setPosition(tag,r,maxFont){
							tag.ele.style.transform="translate("+(tag.x+tagCloud.offsetWidth/2-tag.ele.offsetWidth/2)+"px,"+(tag.y+tagCloud.offsetHeight/2-tag.ele.offsetHeight/2)+"px)";
							tag.ele.style.opacity=tag.z/r/2+0.7;
							tag.ele.style.fontSize=(tag.z/r/2+0.5)*maxFont+"px";
						}
						//绕x轴旋转的函数
						function rotateX(tag){
							var cos=Math.cos(rotateAngleX);
							var sin=Math.sin(rotateAngleX);
							var y1=tag.y*cos - tag.z*sin;
							var z1=tag.y*sin + tag.z*cos;
							tag.y=y1;
							tag.z=z1;
						}
						//绕y轴旋转的函数
						function rotateY(tag){
							var cos=Math.cos(rotateAngleY);
							var sin=Math.sin(rotateAngleY);
							var x1=tag.z*sin+tag.x*cos;
							var z1=tag.z*cos-tag.x*sin;
							tag.x=x1;
							tag.z=z1;
						}
						//鼠标悬浮改变转速和方向
						if(setting.hover){
							tagCloud.onmousemove=function(e){
								rotateAngleY=(e.pageX-this.offsetLeft-this.offsetWidth/2)/10000;
								rotateAngleX=-(e.pageY-this.offsetTop-this.offsetHeight/2)/10000;
							}
						}else{
							tagCloud.onmousemove=null;
						}
						init(setting.radius);
						//开始转动的函数
						setInterval(function(){
							for(var i=0;i<tags.length;i++){
								rotateX(allTag[i]);
								rotateY(allTag[i]);
								setPosition(allTag[i],setting.radius,setting.maxFont);
							}
						},17)
					}
				}
				this.tagCloud=api;
			})();
			tagCloud.config()
			// 参数：{
			// 	radius:number  球体的半径，默认为200
			// 	maxFont：number 最大的标签的字体大小，默认为30,
			// 	color：true|色值 标签字体颜色，如果为true则都是随机颜色，如果是色值，标签就是这个颜色
			// 	rotateAngleXbase：number 默认旋转速度基数，数越小速度越快，默认为300
			// 	rotateAngleYbase：number 同上
			// 	hover：boolean 是否开启悬浮联动， 默认为true
			// }
		</script>
	</body>
</html>